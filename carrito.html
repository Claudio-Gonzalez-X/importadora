<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Inicio | Importadora Larrain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: '#f0f9ff',
                100: '#e0f2fe',
                200: '#bae6fd',
                300: '#7dd3fc',
                400: '#38bdf8',
                500: '#0ea5e9',
                600: '#0284c7',
                700: '#0369a1',
                800: '#075985',
                900: '#0c4a6e',
              },
              secondary: {
                50: '#f0fdf4',
                100: '#dcfce7',
                200: '#bbf7d0',
                300: '#86efac',
                400: '#4ade80',
                500: '#22c55e',
                600: '#16a34a',
                700: '#15803d',
                800: '#166534',
                900: '#14532d',
              },
              accent: {
                50: '#fffbeb',
                100: '#fef3c7',
                200: '#fde68a',
                300: '#fcd34d',
                400: '#fbbf24',
                500: '#f59e0b',
                600: '#d97706',
                700: '#b45309',
                800: '#92400e',
                900: '#78350f',
              },
            },
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
          }
        }
      }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
      .navbar {
        transition: all 0.3s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }
      .navbar.scrolled {
        background-color: white;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      }
      .nav-link {
        position: relative;
        color: #4b5563;
        font-weight: 500;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        transition: all 0.2s;
      }
      .nav-link:hover {
        color: #0ea5e9;
        background-color: #f0f9ff;
      }
      .nav-link.active {
        color: #0ea5e9;
      }
      .cart-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background-color: #ef4444;
        color: white;
        border-radius: 9999px;
        width: 1.25rem;
        height: 1.25rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: 600;
      }
      .page-header {
        background: linear-gradient(135deg, #0ea5e9 0%, #0369a1 100%);
        color: white;
        padding: 4rem 1rem;
        margin-bottom: 2rem;
      }
      .page-title {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
      }
      .page-subtitle {
        font-size: 1.25rem;
        opacity: 0.9;
        max-width: 42rem;
        margin: 0 auto;
      }
      .category-card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
      }
      .category-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .category-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: #0ea5e9;
      }
    </style>
      <style>
          :root {
              --primary-color: #4CAF50;
              --secondary-color: #9C27B0;
              --accent-color: #FFC107;
              --text-primary: #212121;
              --text-secondary: #757575;
              --bg-light: #f5f5f5;
              --bg-dark: #1a1a1a;
          }
          
          body {
              background: linear-gradient(135deg, var(--bg-light) 0%, #ffffff 100%);
              min-height: 100vh;
              color: var(--text-primary);
              font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
              line-height: 1.6;
          }
          
          .container {
              max-width: 1400px;
              margin: 0 auto;
              padding: 2rem;
          }
          
          .header {
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 4rem;
              padding-bottom: 2rem;
              border-bottom: 2px solid rgba(76, 175, 80, 0.1);
          }
          
          .header::before {
              content: '';
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              height: 200px;
              background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
              clip-path: polygon(0 0, 100% 0, 100% 100%, 0 80%);
              z-index: -1;
          }
          .logo {
              font-size: 2rem;
              font-weight: 700;
              color: var(--bg-dark);
              background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
          }
          
          .navigation {
              display: flex;
              gap: 2.5rem;
              align-items: center;
          }
          
          .nav-link {
              color: var(--text-primary);
              text-decoration: none;
              font-weight: 500;
              transition: all 0.3s ease;
              position: relative;
              padding: 0.75rem 1rem;
              border-radius: 8px;
          }
          
          .nav-link::after {
              content: '';
              position: absolute;
              width: 0;
              height: 2px;
              bottom: 0;
              left: 0;
              background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
              transition: width 0.3s ease;
          }
          
          .nav-link:hover::after {
              width: 100%;
          }
          
          .category-grid {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
              gap: 2.5rem;
              padding: 2.5rem 0;
          }
          .category-card {
              background: white;
              border-radius: 16px;
              overflow: hidden;
              box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
              transition: all 0.3s ease;
              border: 2px solid transparent;
              position: relative;
              height: 100%;
          }
          
          .category-card::before {
              content: '';
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              background: linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(156, 39, 176, 0.1));
              opacity: 0;
              transition: opacity 0.3s ease;
          }
          
          .category-card:hover {
              transform: translateY(-8px);
              border-color: var(--primary-color);
          }
          
          .category-card:hover::before {
              opacity: 1;
          }
          
          .category-content {
              padding: 2rem;
              height: 100%;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              text-align: center;
          }
          
          .category-icon {
              font-size: 3rem;
              color: var(--text-secondary);
              margin-bottom: 1.5rem;
              transition: all 0.3s ease;
          }
          
          .category-icon::before {
              content: '';
              position: absolute;
              width: 100%;
              height: 100%;
              background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
              opacity: 0;
              transition: opacity 0.3s ease;
          }
          
          .category-card:hover .category-icon::before {
              opacity: 0.1;
          }
          
          .category-title {
              font-size: 1.5rem;
              font-weight: 600;
              color: var(--text-primary);
              margin-bottom: 1rem;
              transition: color 0.3s ease;
          }
          
          .category-card:hover .category-title {
              color: var(--primary-color);
          }
          
          .category-description {
              color: var(--text-secondary);
              font-size: 1rem;
              line-height: 1.5;
              transition: color 0.3s ease;
          }
          .dropdown {
              position: relative;
              display: inline-block;
          }
          
          .dropdown-toggle {
              position: relative;
              padding: 0.75rem 1rem;
              cursor: pointer;
              border-radius: 8px;
              transition: all 0.3s ease;
          }
          
          .dropdown-toggle:hover {
              background: rgba(76, 175, 80, 0.1);
          }
          
          .dropdown-menu {
              position: absolute;
              top: 100%;
              right: 0;
              background: white;
              border-radius: 12px;
              box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
              min-width: 240px;
              padding: 1rem;
              margin-top: 0.5rem;
              opacity: 0;
              visibility: hidden;
              transform: translateY(-10px);
              transition: all 0.3s ease;
              z-index: 10;
          }
          
          .dropdown:hover .dropdown-menu {
              opacity: 1;
              visibility: visible;
              transform: translateY(0);
          }
          
          .dropdown-item {
              padding: 1rem;
              color: var(--text-primary);
              transition: all 0.2s ease;
              border-radius: 8px;
              display: flex;
              align-items: center;
              gap: 0.5rem;
          }
          
          .dropdown-item:hover {
              background: var(--primary-color);
              color: white;
          }
          
          .dropdown-item i {
              font-size: 1.2rem;
              color: var(--text-secondary);
              transition: color 0.3s ease;
          }
          
          .dropdown-item:hover i {
              color: white;
          }
          
          .cart-badge {
              background: var(--primary-color);
              color: white;
              border-radius: 50%;
              padding: 0.35rem 0.85rem;
              font-size: 0.8rem;
              position: absolute;
              top: -12px;
              right: -12px;
              transform: scale(0);
              transition: transform 0.3s ease;
          }
          
          .dropdown-toggle:hover .cart-badge {
              transform: scale(1);
          }
          @media (max-width: 768px) {
              .navigation {
                  display: none;
              }
              .mobile-menu {
                  display: flex;
                  align-items: center;
                  gap: 1rem;
              }
              .mobile-menu-toggle {
                  font-size: 1.5rem;
                  cursor: pointer;
              }
              .mobile-menu-content {
                  display: none;
                  position: absolute;
                  top: 100%;
                  left: 0;
                  right: 0;
                  background: white;
                  padding: 1rem;
                  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
              }
              .mobile-menu-content.active {
                  display: block;
              }
          }
          .mobile-menu.active {
              max-height: 1000px;
          }
      </style>
  </head>
<body class="bg-gray-50 font-sans">
    <!-- Navbar -->
    <nav class="navbar bg-gray-900 text-white fixed w-full z-10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex items-center">
            <a href="index.html" class="flex-shrink-0 flex items-center">
              <span class="text-xl font-bold bg-gradient-to-r from-primary-600 to-primary-500 bg-clip-text text-transparent">
                <i class="fas fa-store mr-2"></i>Importadora Larrain
              </span>
            </a>
          </div>
          <div class="hidden sm:ml-6 sm:flex sm:items-center space-x-4">
            <a href="index.html" class="px-3 py-2 text-sm font-medium text-primary-600 border-b-2 border-primary-600">Inicio</a>
          </div>
          <div class="-mr-2 flex sm:hidden">
            <button type="button" id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-primary-600 hover:bg-gray-100 focus:outline-none">
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>
      </div>
      <!-- Menú móvil -->
      <div class="sm:hidden hidden" id="mobile-menu">
        <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
          <a href="index.html" class="block px-3 py-2 text-base font-medium text-primary-600 bg-gray-100">Inicio</a>
          <a href="carrito.html" class="block px-3 py-2 text-base font-medium text-gray-700 hover:text-primary-600 hover:bg-gray-100">
            <div class="flex items-center">
              <span>Carrito</span>
              <span id="mobile-cart-count" class="ml-2 bg-primary-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </div>
          </a>
        </div>
      </div>
    </nav>  <!-- Mobile menu, show/hide based on menu state -->
      <div class="hidden sm:hidden" id="mobile-menu">
        <div class="pt-2 pb-3 space-y-1 bg-white border-t border-gray-200">
          <a href="index.html" class="block pl-3 pr-4 py-2 border-l-4 border-primary-500 text-base font-medium text-primary-600 bg-primary-50">
            <i class="fas fa-home mr-2 w-5"></i> Inicio
          </a>
          <a href="login.html" class="block pl-3 pr-4 py-2 border-l-4 border-transparent text-base font-medium text-red-600 hover:bg-red-50 hover:border-red-300 hover:text-red-800">
            <i class="fas fa-sign-out-alt mr-2 w-5"></i> Cerrar Sesión
          </a>
        </div>
      </div>
    </nav>
 
    <!-- Contenido Principal del Carrito -->
    <div class="pt-16">
        <!-- Encabezado de la página -->
        <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white pt-12 pb-16">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-3xl md:text-4xl font-bold mb-3">Carrito de Compras</h1>
                <p id="cart-status" class="text-lg opacity-90">
                    Tienes <span id="item-count" class="font-semibold">0</span> producto(s) en tu carrito
                </p>
            </div>
        </header>

        <!-- Contenido principal -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Estado vacío del carrito -->
            <div id="cart-empty-state" class="bg-white rounded-xl shadow-sm p-8 text-center hidden">
                <div class="max-w-md mx-auto">
                    <div class="w-20 h-20 bg-primary-50 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-shopping-cart text-primary-500 text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">Tu carrito está vacío</h3>
                    <p class="text-gray-600 mb-6">Parece que no has agregado ningún producto a tu carrito aún.</p>
                    <a href="index.html" class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i> Volver al catálogo
                    </a>
                </div>
            </div>

            <!-- Contenido del carrito -->
            <div id="cart-content" class="hidden">
                <div class="lg:flex lg:space-x-6">
                    <!-- Lista de productos -->
                    <div class="lg:w-2/3">
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                            <div class="p-4 border-b border-gray-200">
                                <h2 class="text-lg font-medium text-gray-900">Productos seleccionados</h2>
                            </div>
                            <div id="cart-items-container" class="divide-y divide-gray-200 max-h-[600px] overflow-y-auto">
                                <!-- Los productos del carrito se renderizarán aquí -->
                            </div>
                        </div>
                    </div>

                    <!-- Resumen de la compra -->
                    <div class="mt-6 lg:mt-0 lg:w-1/3">
                        <div class="bg-white rounded-xl shadow-sm p-6 sticky top-24">
                            <h3 class="text-lg font-medium text-gray-900 mb-6">Resumen de la compra</h3>
                            
                            <div class="space-y-4">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Subtotal</span>
                                    <span id="cart-subtotal" class="font-medium text-gray-900">$0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Envío</span>
                                    <span id="cart-shipping" class="font-medium text-gray-900">$0</span>
                                </div>
                                <div class="border-t border-gray-200 pt-4 mt-4">
                                    <div class="flex justify-between">
                                        <span class="text-lg font-semibold">Total</span>
                                        <span id="cart-total" class="text-xl font-bold text-primary-600">$0</span>
                                    </div>
                                </div>
                            </div>

                            <button id="checkout-button" class="mt-6 w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors">
                                <i class="fas fa-credit-card mr-2 mt-0.5"></i> Proceder al pago
                            </button>

                            <div class="mt-4 text-center">
                                <a href="index.html" class="inline-flex items-center text-sm font-medium text-primary-600 hover:text-primary-700">
                                    <i class="fas fa-arrow-left mr-1.5 text-xs"></i> Continuar comprando
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
 
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4 text-center text-gray-400">
                <p>© 2023 Importadora Larrain. Todos los derechos reservados.</p>
        </div>
    </footer>
 
    <!-- Script del carrito corregido -->
    <script>
        // Variables globales
        let cart = [];
        
        // Inicialización cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos del DOM
            const cartEmptyState = document.getElementById('cart-empty-state');
            const cartContent = document.getElementById('cart-content');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartCounter = document.getElementById('cart-counter');
            const mobileCartCount = document.getElementById('mobile-cart-count');
            const itemCount = document.getElementById('item-count');
            const cartSubtotal = document.getElementById('cart-subtotal');
            const cartShipping = document.getElementById('cart-shipping');
            const cartTotal = document.getElementById('cart-total');
            const checkoutButton = document.getElementById('checkout-button');

            // Cargar carrito desde localStorage
            const loadCart = () => {
                const savedCart = localStorage.getItem('cart');
                let tempCart = savedCart ? JSON.parse(savedCart) : [];
                
                // Estandarizar IDs a string
                tempCart.forEach(item => {
                    if (item.id !== undefined && typeof item.id !== 'string') {
                        item.id = item.id.toString();
                        console.log(`[loadCart - carrito.html] ID convertido a string para item: ${item.name}, nuevo ID: ${item.id}`);
                    }
                });
                cart = tempCart; // Asignar el carrito con IDs estandarizados
                
                console.log('Carrito cargado en carrito.html:', cart);
                updateCart();
            };

            // Formatear precio
            const formatPrice = (price) => {
                return '$' + price.toLocaleString('es-CL');
            };

            // Guardar carrito en localStorage
            const saveCart = () => {
                localStorage.setItem('cart', JSON.stringify(cart));
                console.log('Carrito guardado:', cart);
                updateCartCounter();
            };

            // Actualizar contador del carrito
            const updateCartCounter = () => {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                if (cartCounter) cartCounter.textContent = totalItems;
                if (mobileCartCount) mobileCartCount.textContent = totalItems;
                if (itemCount) itemCount.textContent = totalItems;
                
                // Mostrar/ocultar contador
                if (cartCounter) {
                    cartCounter.classList.toggle('hidden', totalItems === 0);
                }
            };

            // Actualizar totales
            const updateTotals = () => {
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const shipping = 0; // Envío gratuito
                const total = subtotal + shipping;

                if (cartSubtotal) cartSubtotal.textContent = formatPrice(subtotal);
                if (cartShipping) cartShipping.textContent = shipping === 0 ? 'Gratis' : formatPrice(shipping);
                if (cartTotal) cartTotal.textContent = formatPrice(total);
            };

            // Actualizar la interfaz del carrito
            const updateCart = () => {
                updateCartCounter();
                updateTotals();
                renderCartItems();
                
                // Mostrar estado vacío o contenido
                if (cartEmptyState && cartContent) {
                    const hasItems = cart.length > 0;
                    cartEmptyState.classList.toggle('hidden', hasItems);
                    cartContent.classList.toggle('hidden', !hasItems);
                    if (checkoutButton) checkoutButton.disabled = !hasItems;
                }


                // Calcular totales
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const shipping = subtotal > 0 ? 0 : 0; // Envío gratuito o calcular según lógica de negocio
                const total = subtotal + shipping;

                // Actualizar totales
                cartSubtotal.textContent = formatPrice(subtotal);
                cartShipping.textContent = shipping === 0 ? 'Gratis' : formatPrice(shipping);
                cartTotal.textContent = formatPrice(total);

                // Actualizar el contador en el navbar
                updateNavbarCartCount();
            };

            // Actualizar el contador en el navbar
            const updateNavbarCartCount = () => {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                const navCartCounter = document.getElementById('cart-counter');
                
                if (totalItems > 0) {
                    navCartCounter.textContent = totalItems;
                    navCartCounter.classList.remove('hidden');
                } else {
                    navCartCounter.classList.add('hidden');
                }
            };

            // Renderizar productos en el carrito
            const renderCartItems = () => {
                if (!cartItemsContainer) return;
                
                cartItemsContainer.innerHTML = '';
                
                if (cart.length === 0) {
                    cartEmptyState.classList.remove('hidden');
                    cartContent.classList.add('hidden');
                    return;
                }
                
                cartEmptyState.classList.add('hidden');
                cartContent.classList.remove('hidden');
                
                cart.forEach(item => {
                    const cartItem = document.createElement('div');
                    cartItem.className = 'p-4 border-b border-gray-200';
                    cartItem.innerHTML = `
                        <div class="flex items-start">
                            <div class="flex-shrink-0 h-20 w-20 rounded-lg overflow-hidden bg-gray-100">
                                <img src="${item.image || 'https://via.placeholder.com/80'}" 
                                     alt="${item.name}" 
                                     class="w-full h-full object-cover">
                            </div>
                            <div class="ml-4 flex-1">
                                <div class="flex justify-between">
                                    <div>
                                        <h3 class="text-base font-medium text-gray-900">
                                            ${item.name || 'Producto sin nombre'}
                                        </h3>
                                        <p class="mt-1 text-sm text-gray-600">${item.category || 'Sin categoría'}</p>
                                        <p class="text-sm font-medium text-gray-900 mt-1">
                                            ${formatPrice(item.price)} c/u
                                        </p>
                                    </div>
                                    <p class="text-lg font-semibold text-gray-900 ml-2 whitespace-nowrap">
                                        ${formatPrice(item.price * item.quantity)}
                                    </p>
                                </div>
                                <div class="mt-3 flex items-center justify-between">
                                    <div class="flex items-center border border-gray-300 rounded-md">
                                        <button type="button" 
                                                onclick="updateQuantity('${item.id}', -1)" 
                                                class="w-8 h-8 flex items-center justify-center text-gray-600 hover:bg-gray-100 focus:outline-none">
                                            <i class="fas fa-minus text-xs"></i>
                                        </button>
                                        <span class="w-8 text-center text-sm">${item.quantity}</span>
                                        <button type="button"
                                                onclick="updateQuantity('${item.id}', 1)" 
                                                class="w-8 h-8 flex items-center justify-center text-gray-600 hover:bg-gray-100 focus:outline-none">
                                            <i class="fas fa-plus text-xs"></i>
                                        </button>
                                    </div>
                                    <button type="button"
                                            onclick="removeFromCart('${item.id}')" 
                                            class="text-sm font-medium text-red-600 hover:text-red-800 flex items-center">
                                        <i class="far fa-trash-alt mr-1"></i>
                                        <span class="hidden sm:inline">Eliminar</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItem);
                });
                
                updateTotals();
            };
            
            // Actualizar cantidad de un producto
            window.updateQuantity = (productId, change) => {
                // productId ya es string desde el onclick
                const itemIndex = cart.findIndex(item => item.id.toString() === productId.toString());
                if (itemIndex === -1) {
                    console.error("Producto no encontrado en updateQuantity:", productId);
                    return;
                }
                
                const newQuantity = cart[itemIndex].quantity + change;
                
                if (newQuantity < 1) {
                    // Confirmación ya está en removeFromCart, o se puede poner aquí también.
                    // Por simplicidad, si la cantidad es < 1, lo eliminamos directamente o llamamos a removeFromCart.
                    // Para mantenerlo simple y directo, si es menos de 1, se elimina.
                    if (confirm('Reducir la cantidad a cero eliminará el producto. ¿Continuar?')) {
                         cart.splice(itemIndex, 1);
                    } else {
                        return; // No hacer nada si el usuario cancela la eliminación por reducción a cero
                    }
                } else {
                    cart[itemIndex].quantity = newQuantity;
                }
                
                saveCart();
                renderCartItems();
            };
            
            // Eliminar producto del carrito
            window.removeFromCart = (productId) => {
                // productId ya es string desde el onclick
                if (confirm('¿Estás seguro de que deseas eliminar este producto del carrito?')) {
                    const initialLength = cart.length;
                    cart = cart.filter(item => item.id.toString() !== productId.toString());
                    
                    if (cart.length < initialLength) {
                        console.log("Producto eliminado:", productId);
                    } else {
                        console.warn("Producto no encontrado para eliminar o filtro falló:", productId);
                    }
                    saveCart();
                    renderCartItems();
                }
            };

            // Manejar clic en el botón de pago
            checkoutButton.addEventListener('click', () => {
                if (cart.length > 0) {
                    // Guardamos el carrito en sessionStorage para pasarlo a la página de pago
                    sessionStorage.setItem('currentCart', JSON.stringify(cart));
                    // Redirigimos a la página de pago en la misma pestaña
                    window.location.href = 'pago.html';
                } else {
                    // Mostrar mensaje de error con un toast o alerta más bonito
                    const toast = document.createElement('div');
                    toast.className = 'fixed bottom-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center';
                    toast.innerHTML = `
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <span>Tu carrito está vacío. Agrega productos antes de proceder al pago.</span>
                    `;
                    document.body.appendChild(toast);
                    
                    // Eliminar el toast después de 3 segundos
                    setTimeout(() => {
                        toast.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                        setTimeout(() => toast.remove(), 300);
                    }, 3000);
                }
            });

            // Efecto de scroll en el navbar
            window.addEventListener('scroll', () => {
                const navbar = document.querySelector('.navbar');
                if (window.scrollY > 10) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            });

            // Inicialización al cargar la página
            loadCart(); // Cargar el carrito desde localStorage
            
            // Asegurarse de que el menú móvil funcione
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }
        });
    </script>
</body>
</html>